default_platform(:ios)

platform :ios do
  lane :codesign_setup do
    # One-time bootstrap to create and upload certs/profiles to the ios_signing branch
    match(
      type: "appstore",
      git_url: "https://github.com/SagheerHussain/otobix-app.git",              # we'll set in CI; locally you can hardcode too
      git_branch: "ios_signing",
      api_key_path: "fastlane/asc_api_key_json_for_github_actions.json",
      team_id: "734JT7MU9R",             # or hardcode your team
      readonly: false
    )
  end

  lane :codesign do
    # CI/read-only usage (downloads profiles/certs created above)
    match(
      type: "appstore",
      git_url: "https://github.com/SagheerHussain/otobix-app.git",
      git_branch: "ios_signing",
      api_key_path: "fastlane/asc_api_key_json_for_github_actions.json",
      readonly: true
    )
  end

  lane :build do
    # typical build lane (optional)
    gym(
      workspace: "Runner.xcworkspace",
      scheme: "Runner",
      configuration: "Release",
      export_method: "app-store"
    )
  end

  lane :release do
    # upload to TestFlight (optional)
    pilot(api_key_path: "fastlane/asc_api_key_json_for_github_actions.json")
  end
end
